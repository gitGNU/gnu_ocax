Before upgrading, read INSTALL to refresh your memory.

1. Make a backup and save it somewhere just in case.
2. Save your app/files folder
3. Save your protected/config/main.php file
4. Overwrite app/ and protected/ with new version
5. Check file permissions # chown -R www-data app/assets/ app/files/ protected/runtime/


1.1.2
Follow steps 1-5 above.

ONLY do this if you have modified budget descriptions.
If you have created or modified budget_descriptions, you need to read this.
In this version of ocax we are separating default descriptions and the descriptions that users create or modify.
That's good because we keep things seperate and we can then update default descriptions without overwriting changes.
So, before you continue updating the database, you need to export the budget descriptions you've modified.

ONLY do this if you have modified budget descriptions.
SELECT `csv_id`, `language`, `code`, `label`, `concept`, `description` FROM `budget_description` WHERE `modified` IS NOT NULL;
(Using phpmyadmin it's easy to export this to a csv format).


This version of OCAX come with some databse changes. You need to update the database.

RENAME TABLE budget_description TO budget_desc_common;
ALTER TABLE budget_desc_common DROP common;
ALTER TABLE budget_desc_common MODIFY `id` int(11) NOT NULL AUTO_INCREMENT;
ALTER TABLE budget_desc_common MODIFY `csv_id` varchar(100) DEFAULT NULL;
ALTER TABLE budget_desc_common MODIFY `code` varchar(32) DEFAULT NULL;

CREATE TABLE IF NOT EXISTS budget_desc_local (
  id int(11) NOT NULL AUTO_INCREMENT,
  csv_id varchar(100) NOT NULL,
  language char(2) NOT NULL,
  code varchar(32) NULL,
  label varchar(32) NULL,
  concept varchar( 255 ) NOT NULL,
  description MEDIUMTEXT,
  text MEDIUMTEXT,	/* description without tags */
  modified DATETIME NULL,
  FULLTEXT (concept, text),
  PRIMARY KEY (id)
) ENGINE=MyISAM DEFAULT CHARSET = utf8;

ALTER TABLE enquiry ADD addressed_to TINYINT(1) DEFAULT 0 NOT NULL;
UPDATE config SET parameter='observatoryName1' WHERE parameter='observatoryName';
INSERT INTO config(parameter, value, required, description) VALUES ('observatoryName2', 'My town', '0', 'Observatory name part 2');
INSERT INTO config(parameter, required, description) VALUES ('socialTwitterUsername', '0', "Observatory's twitter username");



1.1.1
Follow steps 1-6 above.

We've got a new Global Parameter.
INSERT INTO config(parameter, value, required, description) VALUES ('currencySymbol', 'n â‚¬', '1', 'Currency symbol and collocation');

Made database field for csv internal code longer
ALTER TABLE budget MODIFY `csv_id` varchar(100) DEFAULT NULL;
ALTER TABLE budget MODIFY `csv_parent_id` varchar(100) DEFAULT NULL;


1.1.0
Follow steps 1-6 above.
Create a new table in the database

CREATE TABLE IF NOT EXISTS archive (
  id int(11) NOT NULL AUTO_INCREMENT,
  name varchar(255) NOT NULL,
  path varchar(255) NOT NULL,
  extension varchar(5) NULL,
  author int(11) NOT NULL,
  description TEXT NOT NULL,
  created date NOT NULL,
  FOREIGN KEY (author) REFERENCES user(id),
  PRIMARY KEY (id)
) ENGINE=INNODB DEFAULT CHARSET = utf8;


1.0.4
Nothing special to do. Follow steps 1-4 above.

1.0.3
1. Save your app/files folder
2. Save protected/config/main.php
2. Overwrite app/ and protected/
3. Restore app/files and protected/config/main.php


1.0.2
Database changes
----------------
We changed two feilds in the database table intro_page from TINYINT(3) to INT(3)
You need to do this.

ALTER TABLE intro_page MODIFY toppos INT(3);
ALTER TABLE intro_page MODIFY leftpos INT(3);
ALTER TABLE intro_page ADD color varchar(6) NOT NULL DEFAULT '222222' AFTER leftpos;
ALTER TABLE intro_page ADD bgcolor varchar(6) NOT NULL DEFAULT 'FFFFFF' AFTER color;
ALTER TABLE intro_page ADD opacity TINYINT(1) NOT NULL DEFAULT '8' AFTER bgcolor;

There is a new GLobal parameter.

INSERT INTO config(parameter, value, required, description) VALUES ('membership', '0', '1', 'Does your Observatory encourage membership? (0 or 1)');
